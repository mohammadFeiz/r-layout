import e,{createContext as t,useContext as n,useEffect as i,useState as o}from"react";import r from"jquery";import"./index.css";import{jsx as s}from"react/jsx-runtime";import{Fragment as a}from"react/jsx-runtime";import{jsxs as d}from"react/jsx-runtime";function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}let RVDContext=t({});export default function l(e){let{rootNode:t}=e,[n]=o({});function i(e){return n[e]}function r(e,t){n[e]=t}let[a,d]=o(e.state),l=(e,t)=>d("string"==typeof e?{...a,[e]:t}:e);return s(RVDContext.Provider,{value:{getTemp:i,setTemp:r,rootProps:e,state:a,setState:l},children:s(RVDNode,{node:t,index:0,level:0})})};function RVDNode(e){var t;let r=n(RVDContext),{rootProps:l,state:h,setState:u}=r,{parent:m,index:c,level:p}=e,[g,f]=o(!1);if(i(()=>{"number"==typeof e.node.mountAfter&&setTimeout(()=>f(!0),e.node.mountAfter)},[]),!e.node||null===e.node||("function"==typeof e.node.show?e.node.show():e.node.show)===!1)return null;let $=function t(){var n,i,o,r;let{node:s}=e;l.editNode&&(s=l.editNode(s,m)),s.loading=(n=s,i=m,"boolean"==typeof n.loading?n.loading:!!i&&!!i.loading);let a;return s.nodeClasses=(o=s,r=m,a=[],r&&r.nodeClasses&&(a=[...r.nodeClasses]),o.nodeClass&&(a=[...a,o.nodeClass]),a),s}(),v,y,x=v=(y=function e(t){let n=[];if(t.row)n="function"==typeof t.row?t.row({state:h,setState:u}):t.row;else if(t.column)n="function"==typeof t.column?t.column({state:h,setState:u}):t.column;else if(t.grid){let{gridCols:i=2}=t,o="function"==typeof t.grid?t.grid({state:h,setState:u}):t.grid;for(let r=0;r<o.length;r+=i){let s=[],a="function"==typeof t.gridRow?t.gridRow(r):t.gridRow;for(let d=r;d<r+i;d++)o[d]&&s.push(o[d]);n.push({row:[...s],...a})}t.column=[...n]}return n}(t=$)).length?y.map((e,n)=>{let i=void 0===e.key?n:e.key;return s(RVDNode,{node:e,index:n,level:p+1,parent:t},i)}):function e(t){let{html:n="",loading:i}=t;n=("function"==typeof n?n({state:h,setState:u}):n)||"";let o;return i&&n?d(a,{children:[s("div",{style:{opacity:0},children:n}),s("div",{className:"rvd-loading"})]}):n}(t),w=new RVDAttrs({node:$,parent:m,level:p,index:c,context:r,mounted:g}).getAttrs(),D=getGap({node:$,parent:m,dataId:w["data-id"],rtl:l.rtl,index:c,level:p,context:r});return d(a,{children:[s("div",{...w,children:x}),null!==D&&D]})}class RVDAttrs{constructor(e){_defineProperty(this,"node",void 0),_defineProperty(this,"parent",void 0),_defineProperty(this,"level",void 0),_defineProperty(this,"index",void 0),_defineProperty(this,"context",void 0),_defineProperty(this,"mounted",void 0),_defineProperty(this,"getStyle",()=>{let{size:e,flex:t,attrs:n={}}=this.node,i={...this.node.style||n.style||{}};return void 0!==e&&this.parent&&(this.parent.row?(i.width=e,t=void 0):(this.parent.column||this.parent.grid)&&(i.height=e,t=void 0)),{flex:t,...i}}),_defineProperty(this,"getOnClick",()=>{let{onClick:e,attrs:t={},loading:n}=this.node;if(!n)return e||t.onClick}),_defineProperty(this,"getDragAttrs",()=>{let e=this.parent&&this.parent.reOrder&&Array.isArray(this.parent.data),t=this.node.onDrag||this.node.onDrop;if(!e&&!t)return{};let{rootProps:n,getTemp:i,setTemp:o}=this.context,{dragHandleClassName:s}=n,a={};return a.draggable=!0,a.onDragStart=t=>{(!s||r(t.target).hasClass(s)||0!==r(t.target).parents("."+s).length)&&(e?o("dragIndex",this.index):this.node.onDrag&&this.node.onDrag(t))},a.onDragOver=e=>e.preventDefault(),a.onDrop=t=>{if(e){let n=i("dragIndex");!1!==n&&n!==this.index&&(this.parent.reOrder(ReOrder({data:this.parent.data,fromIndex:n,toIndex:this.index}),n,this.index),o("dragIndex",!1))}else this.node.onDrop&&this.node.onDrop(t)},a}),_defineProperty(this,"getClassName",()=>{let{classes:e={}}=this.context.rootProps,t="rvd";0===this.level&&(t+=" rvd-root");let{attrs:n={},nodeClass:i,nodeClasses:o,row:r,column:s,grid:a,loading:d,wrap:l,mountAfter:h}=this.node;if(this.node.className){let u,m=e[u=Array.isArray(this.node.className)?this.node.className.filter(e=>!!e&&"string"==typeof e).join(" "):this.node.className];"function"==typeof m?u=m(this.node,this.parent):"string"==typeof m&&(u=m),u&&"string"==typeof u&&(t+=" "+u)}n.className&&(t+=" "+n.className),l&&(t+=" wrap"),i&&(t+=" "+o.join("-")),n.onClick&&(t+=" pointer"),this.node.align&&(t+=` align-${this.node.align}`),r?t+=" rvd-row":(s||a)&&(t+=" rvd-column"),d&&(t+=" rvd-parent-loading");let c=getHideClassName(this.node);return c&&(t+=" "+c),this.mounted||"number"!=typeof h||(t+=" not-mounted"),t}),_defineProperty(this,"getLongTouchAttrs",e=>{let{longTouch:t}=this.node,{setTemp:n}=this.context;if("function"!=typeof t)return{};let i={};return i["ontouchstart"in document.documentElement?"onTouchStart":"onMouseDown"]=i=>{n("lt",e),n(e+"callback",t),this.timer(),eventHandler("mouseup",this.longTouchMouseUp)},i}),_defineProperty(this,"timer",()=>{let{setTemp:e,getTemp:t}=this.context,n=t("lt");e("time",0),e(n+"interval",setInterval(()=>{let i=t("time");if(e("time",++i),i>50){clearInterval(t(n+"interval"));t(n+"callback")()}},10))}),_defineProperty(this,"longTouchMouseUp",()=>{let{getTemp:e}=this.context;eventHandler("mouseup",this.longTouchMouseUp,"unbind");let t=e("lt");clearInterval(e(t+"interval"))}),_defineProperty(this,"getAttrs",()=>{let e=this.node.attrs?{...this.node.attrs}:{},t="a"+Math.random();return e["data-id"]=t,e.style=this.getStyle(),e.onClick=this.getOnClick(),(e={...e,...this.getDragAttrs()}).className=this.getClassName(),e={...e,...this.getLongTouchAttrs(t)}});let{node:t,parent:n,level:i,index:o,context:s,mounted:a=!1}=e;this.node=t,this.mounted=a,this.parent=n,this.level=i,this.index=o,this.context=s}}export function animate(e,t,n){if(Array.isArray(e))for(var i=0;i<e.length;i++){var[o,s]=e[i];r(t).delay(0===i?0:e[i-1].time).animate(o,s,i===e.length-1?n:null)}else"removeV"===e?r(t).animate({opacity:0},250).animate({height:0,padding:0,margin:0},200,n):"removeH"===e?r(t).animate({opacity:0},250).animate({width:0,padding:0,margin:0},200,n):"removeL"===e?r(t).animate({right:"100%"},250).animate({height:0,width:0,padding:0,margin:0},200,n):"removeR"===e?r(t).animate({left:"100%"},250).animate({height:0,width:0,padding:0,margin:0},200,n):"remove"===e&&r(t).animate({opacity:0},250).animate({width:0,height:0,padding:0,margin:0},200,n)}function eventHandler(e,t,n="bind"){e="ontouchstart"in document.documentElement?({mousemove:"touchmove",mouseup:"touchend"})[e]:e,r(window).unbind(e,t),"bind"===n&&r(window).bind(e,t)}function getGap(e){let{node:t,parent:n={},dataId:i,rtl:o,index:a,level:d,context:l}=e;return({getClient:e=>"ontouchstart"in document.documentElement?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:{x:e.clientX,y:e.clientY},mouseMove(e){var{pos:t,size:s}=this.so,a=this.getClient(e);let d=n.row?"x":"y";var l=(a[d]-t[d])*(o?-1:1);this.so.newSize=l+s,r('[data-id="'+i+'"]').css({[({x:"width",y:"height"})[d]]:this.so.newSize})},mouseUp(){eventHandler("mousemove",this.mouseMove,"unbind"),eventHandler("mouseup",this.mouseUp,"unbind");let{newSize:e}=this.so;t.onResize(e)},getGap(){let{gap:e}=n;if(!(e="function"==typeof e?e({node:t,parent:n,index:a,level:d}):e)||!n)return null;let i={draggable:!1,onDragStart:e=>(e.preventDefault(),!1)},o="rvd-gap";t.size&&t.onResize&&(o+=n.row?" col-resize":" row-resize",i["ontouchstart"in document.documentElement?"onTouchStart":"onMouseDown"]=e=>{this.so={pos:this.getClient(e),size:t.size},eventHandler("mousemove",r.proxy(this.mouseMove,this)),eventHandler("mouseup",r.proxy(this.mouseUp,this))}),e.className&&(o+=" "+e.className);let h={node:{...e,className:o,attrs:{...e.attrs,...i}},parent:n,level:d,index:a,context:l},u=new RVDAttrs(h).getAttrs(),{html:m=""}=e;return t.loading&&(m=""),s("div",{...u,children:m})}}).getGap()}function getHideClassName(e){let t,n,i,o,r="";return e.show_xs&&(t=!1,n=!0,i=!0,o=!0),e.hide_xs&&(t=!0),e.show_sm&&(t=!0,n=!1,i=!0,o=!0),e.hide_sm&&(n=!0),e.show_md&&(t=!0,n=!0,i=!1,o=!0),e.hide_md&&(i=!0),e.show_lg&&(t=!0,n=!0,i=!0,o=!1),e.hide_lg&&(o=!0),t&&(r+=" rvd-hide-xs"),n&&(r+=" rvd-hide-sm"),i&&(r+=" rvd-hide-md"),o&&(r+=" rvd-hide-lg"),r}function Cls(e,t){let n=`rvd-${e}`;return t&&(n+=" "+t),n}function ReOrder(e){let{data:t,fromIndex:n,toIndex:i}=e,o=t[n],r=t.filter((e,t)=>t!==n);return r.splice(i,0,o),r}